# 開発知見・技術ノウハウ集

本プロジェクト（注意障害リハビリアプリ）の開発を通じて得られた、特にスマートフォン向けWebアプリケーション開発やReact実装に関する重要な知見をまとめました。

## 1. スマートフォン向けWebアプリ開発の知見

### タッチ反応の最適化
*   **イベントハンドラの選定**: モバイル端末では `onClick` よりも `onPointerDown` を使用することで、タップ時の反応遅延（300ms問題など）を解消し、より即応性の高い操作感を実現できる。
*   **タッチアクションの制御**: CSSで `touch-action: none` を指定することで、ブラウザのデフォルトのズームやスクロール動作を無効化し、ゲームプレイ中の誤操作を防ぐことができる。
*   **重なり順序（z-index）の管理**: HUD（スコア表示など）や背景要素とインタラクティブな要素（ターゲット）が重なる場合、`z-index` を明示的に指定してインタラクティブ要素を最前面に配置しないと、タップが反応しない場合がある。特に透明なコンテナが前面にあるとイベントを遮断してしまうため注意が必要。

### 座標計算とレスポンシブ対応
*   **相対座標の記録**: 画面サイズが異なるデバイス間でクリック位置（ヒートマップ）を正しく共有・表示するためには、絶対座標（px）ではなく、記録時の画面サイズ（幅・高さ）に対する相対位置（%）または正規化された座標系を使用する必要がある。
*   **基準点の統一**: オブジェクトの描画座標（左上基準）と当たり判定や分析用の座標（中心基準）が混在するとズレの原因となるため、計算ロジック内で明確に統一することが不可欠。

## 2. Reactにおける高頻度更新とタイマー処理

### 正確なタイマー実装
*   **Date.now()の活用**: `setInterval` で単にカウンタを減らす実装は、処理落ちやブラウザのタブ非アクティブ化によって時間がずれる可能性がある。開始時刻を `Date.now()` で記録し、現在時刻との差分から経過時間を計算することで、正確なタイマーを実現できる。
*   **クロージャの罠の回避**: `useEffect` や `setInterval` 内から最新の State を参照する場合、クロージャにより古い値が参照され続ける問題がある。これを防ぐため、`useRef` を使用して最新の値を保持・参照するパターンが有効。

### パフォーマンス最適化
*   **レンダリング抑制**: タイマーの更新など、高頻度で再レンダリングが発生する処理において、Reactのレンダリングサイクル外で管理できる値（Ref）と、表示用に更新が必要な値（State）を適切に使い分けることが重要。
*   **key属性による強制再描画**: 特定の条件下（SPでの表示崩れなど）でコンポーネントの更新が正しく反映されない場合、`key` 属性を変更してコンポーネントを強制的に再マウントさせる手法がバグ修正の最終手段として有効な場合がある。

## 3. 臨床用アプリケーションのUI設計

### 視認性とアクセシビリティ
*   **配色の工夫**: 視認性を高めるため、OKLCH色空間などを活用して知覚的な明るさを調整する。また、ターゲットと背景のコントラスト比を確保する。
*   **フィードバック**: ユーザーの操作に対して、視覚的（エフェクト）および聴覚的（効果音）なフィードバックを即座に返すことで、認知機能のリハビリテーション効果を高めることができる。

## 4. PWA（Progressive Web Apps）
*   **オフライン対応**: `vite-plugin-pwa` を使用し、画像や音声などの静的アセットをキャッシュ戦略に含めることで、ネットワーク環境がない場所でも安定して動作するアプリを提供できる。
